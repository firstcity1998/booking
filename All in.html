<!DOCTYPE html>
<html lang="th">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <title>‡∏ú‡∏±‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏£‡πâ‡∏≤‡∏ô All In</title>

  <!-- Firebase + Script ‡∏´‡∏•‡∏±‡∏Å -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyByEiQP04T_RxQ88CMZRWxUMI_r9ra5ub4",
  authDomain: "purdto-platform.firebaseapp.com",
  projectId: "purdto-platform",
  messagingSenderId: "670687363597",
  appId: "1:670687363597:web:dd96a5936c87ad27dd0b44"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

export { db };


  const restaurantId = "all in";
  const tablesRef = collection(db, "restaurants", restaurantId, "tables");
  const selectedTables = new Set();
  window.selectedTables = selectedTables;
  const tableElements = {};

  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".table").forEach(el => {
      const id = el.dataset.table;
      tableElements[id] = el;
    });

    onSnapshot(tablesRef, snapshot => {
      snapshot.docChanges().forEach(change => {
        const id = change.doc.id;
        const data = change.doc.data();
        const el = tableElements[id];
        if (!el) return;

        el.classList.remove("selected", "reserved");

        if (data.status === "reserved") {
      el.classList.add("reserved");
      el.style.background = "#9ca3af";
      el.style.pointerEvents = "none";
      el.style.cursor = "default";
      el.onclick = null;
    } else if (data.status === "blocked") {
      el.classList.add("reserved");
      el.textContent = "‚ùå";
      el.style.pointerEvents = "none";
      el.style.cursor = "default";
      el.onclick = null;
    } else {
      el.style.background = "black";
      el.style.pointerEvents = "auto";
      el.style.cursor = "pointer";
      el.onclick = () => {
        el.classList.toggle("selected");
        if (selectedTables.has(id)) {
          selectedTables.delete(id);
        } else {
          selectedTables.add(id);
        }
        updateSummary();
      };
    }
  });
});

    window.reserveTables = async (userId) => {
      if (selectedTables.size === 0) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡πà‡∏≠‡∏ô");
        return;
      }

      const batch = writeBatch(db);
      const now = new Date();

      selectedTables.forEach(id => {
        const ref = doc(db, "restaurants", restaurantId, "tables", id);
        batch.update(ref, {
          status: "reserved",
          reservedBy: userId,
          timestamp: now
        });
      });

      try {
        await batch.commit();
        return true;
      } catch (err) {
        console.error("Error reserving tables:", err);
        alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏ì‡∏∞‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞");
        return false;
      }
    };
  });
</script>

<!-- LIFF SDK -->
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<!-- LIFF + UI Interaction -->
<script>
  const pricePerTable = 50;
  let displayName = "‡∏Ñ‡∏∏‡∏ì";

  document.addEventListener("DOMContentLoaded", async () => {
    const summary = document.getElementById('summary');
    const confirmBtn = document.getElementById('confirmBtn');
    const tables = document.querySelectorAll('.table');

    await liff.init({ liffId: "2007619597-pL1yYoj3" });
    if (!liff.isLoggedIn()) {
      liff.login();
    } else {
      const profile = await liff.getProfile();
      displayName = profile.displayName || "‡∏Ñ‡∏∏‡∏ì";
    }

   

    confirmBtn.addEventListener('click', async () => {
      const tableList = Array.from(selectedTables).sort((a, b) => a.localeCompare(b));
      const total = tableList.length * pricePerTable;

      if (tableList.length === 0) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡πà‡∏≠‡∏ô‡∏à‡∏≠‡∏á");
        return;
      }

      const success = await window.reserveTables(liff.getDecodedIDToken().sub);
      if (!success) return;

      const flexMessage = {
        type: "flex",
        altText: "üìå ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞",
        contents: {
          type: "bubble",
          header: {
            type: "box",
            layout: "vertical",
            contents: [{
              type: "text",
              text: "üìå ‡∏£‡πâ‡∏≤‡∏ô All In",
              weight: "bold",
              size: "lg",
              color: "#a855f7"
            }]
          },
          body: {
            type: "box",
            layout: "vertical",
            spacing: "sm",
            contents: [
              {
                type: "text",
                text: `${displayName} ‡πÑ‡∏î‡πâ‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞`,
                weight: "bold",
                size: "md"
              },
              {
                type: "text",
                text: `‡πÇ‡∏ï‡πä‡∏∞: ${tableList.join(', ')}`,
                size: "sm",
                wrap: true
              },
              {
                type: "text",
                text: `‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${total} ‡∏ö‡∏≤‡∏ó`,
                size: "sm",
                weight: "bold",
                color: "#10b981"
              }
            ]
          }
        }
      };

      try {
        await liff.sendMessages([flexMessage]);
        alert("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
        liff.closeWindow();
      } catch (err) {
        console.error("Send message error:", err);
        alert("‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }
    });

    window.updateSummary = () => {
      if (selectedTables.size === 0) {
        summary.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞';
        return;
      }
      const tableList = Array.from(selectedTables).sort((a, b) => a.localeCompare(b));
      const total = tableList.length * pricePerTable;
      summary.textContent = `‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${tableList.join(', ')} | ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°: ${total} ‡∏ö‡∏≤‡∏ó`;
    };
  });
</script>

  <style>
    @media screen and (max-width: 768px) {
  .layout {
    transform: scale(0.8);
    transform-origin: top center;
  }
}
.restaurant-name {
      position: absolute;
      top: 30%;
      left: 40%;
      transform: translate(-50%, -50%);
      font-size: 36px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0 12px;
      color: #facc15;
      text-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }
    body {
  margin: 0;
  padding: 0;
  font-family: 'Arial', sans-serif;
  background: radial-gradient(circle at top left, #6a0dad, #2c003e);
  background-repeat: no-repeat;
  background-attachment: fixed;
  height: 100vh;
  overflow: hidden; /* ‚ùå ‡∏õ‡∏¥‡∏î scroll ‡∏ó‡∏∏‡∏Å‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á */
  display: flex;
  justify-content: center;
  align-items: center;
}
.layout {
  width: 900px;
  height: 650px;
  position: relative;
 /* background: rgba(255, 255, 255, 0.05);*/
  border-radius: 16px;
  transform-origin: top center;
}



    .stage {
      position: absolute;
      top: 30px;
      left: 10px;
      width: 250px;
      height: 100px;
      background: #ff5c5c;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
    }

    .table {
      position: absolute;
      width: 70px;
      height: 70px;
      background: black;
      color: white;
      font-weight: bold;
      font-size: 18px;
      display: flex;
      justify-content: center;
      align-items: center;
      clip-path: polygon(10% 0%, 90% 0%, 100% 10%, 100% 90%, 90% 100%, 10% 100%, 0% 90%, 0% 10%);
      cursor: pointer;
      transition: background 0.3s;
    }

    .table-b {
  width: 50px;
  height: 50px;
  font-size: 18px;
  background: #111;
}

    .table.selected {
      background-color: #2ecc71;
    }

    .door {
      position: absolute;
      width: 25px;
      height: 50px;
      border: 2px solid rgb(252, 248, 248);
    }

    .door::after {
      content: '';
      position: absolute;
      width: 5px;
      height: 5px;
      background: rgb(255, 255, 255);
      border-radius: 50%;
      top: 50%;
      left: 5px;
      transform: translateY(-50%);
    }

    .seat, .bar {
      position: absolute;
      background: white;
      border: 2px solid black;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 14px;
      writing-mode: vertical-rl;
    }

    .seat {
      width: 80px;
      height: 270px;
    }

    .bar {
      width: 60px;
      height: 240px;
    }

    .bar-center {
      width: 150px;
      height: 60px;
      writing-mode: horizontal-tb;
    }

    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏≠‡∏°‡∏≤‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô */
    .t1 { top: 5px; left: 400px; }
    .t2 { top: 90px; left: 400px; }

    .t3 { top: 160px; left: 300px; }
    .t4 { top: 235px; left: 300px; }
    .t5 { top: 310px; left: 300px; }
    .t6 { top: 385px; left: 300px; }

    .t7 { top: 140px; left: 20px; }
    .t8 { top: 215px; left: 20px; }
    .t9 { top: 290px; left: 20px; }
    .t10 { top: 365px; left: 20px; }
    .t11 { top: 440px; left: 20px; }

    .t12 { top: 520px; left: 5px; }
    .t13 { top: 595px; left: 5px; }

    .b1 { top: 460px; left: 230px; }
    .b2 { top: 520px; left: 230px; }
    .b3 { top: 580px; left: 230px; }
    .b4 { top: 640px; left: 230px; }

    .seat { top: 170px; left: 380px; }

    .bar-left   { top: 460px; left: 300px; }
    .bar-right  { top: 460px; left: 520px; }
    .bar-center { top: 460px; left: 365px; }

    .door-top-right { top: 20px; left: 360px; }
    .door-bottom-left { top: 680px; left: 15px; }

    #summary {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #f7f7f7;
      border-top: 1px solid #ccc;
      padding: 10px;
      font-size: 16px;
      text-align: center;
    }
    .table.reserved {
  background-color: #9ca3af !important;
  cursor: not-allowed;
  pointer-events: none;
}

  </style>
</head>
<body>
  <h1  class="restaurant-name">All In</h1>
  

  <div class="layout">
    <div class="stage">STAGE</div>

    <!-- ‡πÇ‡∏ï‡πä‡∏∞ -->
    <div class="table t1" data-table="1">1</div>
    <div class="table t2" data-table="2">2</div>
    <div class="table t3" data-table="3">3</div>
    <div class="table t4" data-table="4">4</div>
    <div class="table t5" data-table="5">5</div>
    <div class="table t6" data-table="6">6</div>
    <div class="table t7" data-table="7">7</div>
    <div class="table t8" data-table="8">8</div>
    <div class="table t9" data-table="9">9</div>
    <div class="table t10" data-table="10">10</div>
    <div class="table t11" data-table="11">11</div>
    <div class="table t12" data-table="12">12</div>
    <div class="table t13" data-table="13">13</div>
    <div class="table table-b b1" data-table="B1">B1</div>
<div class="table table-b b2" data-table="B2">B2</div>
<div class="table table-b b3" data-table="B3">B3</div>
<div class="table table-b b4" data-table="B4">B4</div>

    <!-- ‡∏≠‡∏á‡∏Ñ‡πå‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
    <div class="seat">seat</div>
    <div class="bar bar-left">Bar</div>
    <div class="bar bar-center">Bar</div>
    <div class="bar bar-right">Bar</div>
    <div class="door door-top-right"></div>
    <div class="door door-bottom-left"></div>
  </div>

  <div id="summary">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞</div>

<div style="text-align: center; margin: 20px;">
  <button id="confirmBtn" onclick="bookSeats()" style="
    position: fixed;
    bottom: 50px;
    left: 50%;
    transform: translateX(-50%);
    background-color: rgb(253, 187, 7);
    color: white;
    padding: 12px 24px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    z-index: 999;
  ">
    ‡∏à‡∏≠‡∏á‡πÄ‡∏•‡∏¢
  </button>
</div>



</body>
</html>   