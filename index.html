<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    .restaurant-name {
      font-size: 36px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 12px;
      color: #facc15;
      text-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }
    body {
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(to bottom, #2d004b, #0e0e0e);
      color: white;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .container {
      width: 100%;
      max-width: 400px;
      padding: 20px;
      box-sizing: border-box;
    }
    .stage {
      background: #b91c1c;
      text-align: center;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 16px;
    }
    .seat-map {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 10px;
      margin-bottom: 20px;
      position: relative;
    }
    .seat {
      background: #444;
      padding: 10px;
      border-radius: 6px;
      text-align: center;
      cursor: pointer;
    }
    .seat.selected {
      background: #facc15;
      color: black;
    }
    .seat.reserved {
      background: #9ca3af;
      cursor: not-allowed;
    }
    .bathroom-icon {
      position: absolute;
      top: 0;
      font-size: 16px;
    }
    .bathroom-left {
      left: -30px;
    }
    .bathroom-right {
      right: -30px;
    }
    .legend {
      display: flex;
      justify-content: space-around;
      font-size: 14px;
      margin-bottom: 10px;
    }
    .legend div {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .dot {
      width: 12px;
      height: 12px;
      border-radius: 3px;
    }
    .dot.available { background: #444; }
    .dot.selected { background: #facc15; }
    .dot.reserved { background: #9ca3af; }
    .summary {
      text-align: center;
      margin-bottom: 10px;
    }
    button {
      width: 100%;
      padding: 12px;
      background: #f59e0b;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      color: black;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1 class="restaurant-name">Vyse</h1>
  <div class="container">
    <div class="stage">‡πÄ‡∏ß‡∏ó‡∏µ</div>
    <div class="seat-map" id="seatMap">
      <div class="bathroom-icon bathroom-left">üöª</div>
      <div class="bathroom-icon bathroom-right">üöª</div>
      <!-- ‡πÇ‡∏ï‡πä‡∏∞ A1 - F5 -->
      <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏ï‡πä‡∏∞‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏° -->
    </div>
    <div class="legend">
      <div><div class="dot available"></div> ‡∏ß‡πà‡∏≤‡∏á</div>
      <div><div class="dot reserved"></div> ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</div>
      <div><div class="dot selected"></div> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</div>
    </div>
    <div class="summary">
      ‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó
    </div>
    <button onclick="bookSeats()">‡∏à‡∏≠‡∏á‡πÄ‡∏•‡∏¢</button>
  </div>

  <script>
    const pricePerSeat = 50;
    const selected = new Set();
    const total = document.getElementById('total');

    document.querySelectorAll('.seat').forEach(seat => {
      const id = seat.dataset.id;
      if (seat.classList.contains('reserved')) return;
      seat.addEventListener('click', () => {
        seat.classList.toggle('selected');
        if (selected.has(id)) {
          selected.delete(id);
        } else {
          selected.add(id);
        }
        total.textContent = selected.size * pricePerSeat;
      });
    });

    let userId = null;

    liff.init({ liffId: "2007619597-pL1yYoj3" })
      .then(() => {
        if (!liff.isLoggedIn()) {
          liff.login();
        } else {
          return liff.getProfile();
        }
      })
      .then(profile => {
        userId = profile.userId;
        console.log("üîê userId:", userId);
      })
      .catch(err => {
        console.error("‚ùå LIFF Init Error:", err);
      });

    function bookSeats() {
      if (selected.size === 0) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡πà‡∏≠‡∏ô");
        return;
      }
      const bookedTables = [...selected];
      const url = "https://script.google.com/macros/s/AKfycbyPBchWeOWEOF71695gujPcAQlpZsOlQdSQ4CVFtL0JqklVLZUdaCelOUbQmL7EZgeFPQ/exec";
      fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ userId, tables: bookedTables, status: "Booked" })
      })
      .then(res => res.json())
      .then(data => {
        console.log("‚úÖ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", data);
        if (liff.isInClient()) {
          return liff.sendMessages([
            {
              type: "flex",
              altText: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞",
              contents: {
                type: "bubble",
                body: {
                  type: "box",
                  layout: "vertical",
                  contents: [
                    { type: "text", text: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á", weight: "bold", size: "lg" },
                    { type: "text", text: `‡πÇ‡∏ï‡πä‡∏∞: ${bookedTables.join(", ")}`, margin: "md" },
                    { type: "text", text: `‡∏£‡∏ß‡∏° ${bookedTables.length * 50} ‡∏ö‡∏≤‡∏ó`, margin: "sm" }
                  ]
                }
              }
            }
          ]).then(() => liff.closeWindow());
        } else {
          alert("‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + bookedTables.join(", "));
        }
      })
      .catch(err => {
        console.error("‚ùå ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß", err);
        alert("‚ùå ‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
      });
    }
  </script>
</body>
</html>
