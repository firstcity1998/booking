<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    /* ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏ä‡πâ */
    .restaurant-name {
      font-size: 36px;
      font-weight: bold;
      text-align: center;
      margin: 20px 0 12px;
      color: #facc15;
      text-shadow: 0 2px 10px rgba(0,0,0,0.6);
    }
    body {
      font-family: 'Prompt', sans-serif;
      background: linear-gradient(to bottom, #2d004b, #0e0e0e);
      color: white;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    .container { max-width: 400px; width: 100%; padding: 20px; box-sizing: border-box; }
    .stage { background: #b91c1c; text-align: center; padding: 10px; border-radius: 8px; margin-bottom: 16px; }
    .seat-map { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; }
    .seat { background: #444; padding: 10px; border-radius: 6px; text-align: center; cursor: pointer; }
    .seat.selected { background: #facc15; color: black; }
    .seat.reserved { background: #9ca3af; cursor: not-allowed; }
    .legend { display: flex; justify-content: space-around; font-size: 14px; margin-bottom: 10px; }
    .legend div { display: flex; align-items: center; gap: 6px; }
    .dot { width: 12px; height: 12px; border-radius: 3px; }
    .dot.available { background: #444; }
    .dot.selected { background: #facc15; }
    .dot.reserved { background: #9ca3af; }
    .summary { text-align: center; margin-bottom: 10px; }
    button { width: 100%; padding: 12px; background: #f59e0b; border: none; border-radius: 8px; font-size: 16px; color: black; cursor: pointer; }
  </style>
</head>
<body>
  <h1 class="restaurant-name">Vyse</h1>
  <div class="container">
    <div class="stage">‡πÄ‡∏ß‡∏ó‡∏µ</div>
    <div class="seat-map" id="seatMap"></div>
    <div class="legend">
      <div><div class="dot available"></div> ‡∏ß‡πà‡∏≤‡∏á</div>
      <div><div class="dot reserved"></div> ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</div>
      <div><div class="dot selected"></div> ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß</div>
    </div>
    <div class="summary">‡∏£‡∏ß‡∏°: <span id="total">0</span> ‡∏ö‡∏≤‡∏ó</div>
    <button onclick="bookSeats()">‡∏à‡∏≠‡∏á‡πÄ‡∏•‡∏¢</button>
  </div>

<script>
  const seatMap = document.getElementById('seatMap');
  const total = document.getElementById('total');
  const pricePerSeat = 50;
  const selected = new Set();
  const reservedSeats = ["A3", "B4"]; // ‚Üê ‡πÇ‡∏ï‡πä‡∏∞‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å Google Sheet ‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ

  const allSeats = [
    "A1", "A2", "A3", "A4", "A5",
    "B1", "B2", "B3", "B4", "B5",
    "C1", "C2", "C3", "C4", "C5",
    "D1", "D2", "D3", "D4", "D5",
    "E1", "E2", "E3", "E4", "E5",
    "F1", "F2", "F3", "F4", "F5"
  ];

  allSeats.forEach(id => {
    const seat = document.createElement('div');
    seat.className = 'seat';
    seat.textContent = id;
    seat.dataset.id = id;

    if (reservedSeats.includes(id)) {
      seat.classList.add('reserved');
    } else {
      seat.addEventListener('click', () => {
        seat.classList.toggle('selected');
        if (selected.has(id)) {
          selected.delete(id);
        } else {
          selected.add(id);
        }
        total.textContent = selected.size * pricePerSeat;
      });
    }
    seatMap.appendChild(seat);
  });

  let userId = null;

  async function bookSeats() {
    if (selected.size === 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏ï‡πä‡∏∞‡∏Å‡πà‡∏≠‡∏ô");
    if (!userId) return alert("‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà...");

    const bookedTables = [...selected];
    const url = "https://script.google.com/macros/s/AKfycbwiiXPW1yvtGwBZi2TR7xPkEiGnod4qkOvrsHMIoBDPPQWW7lupLn0f1Qi4TvJ8Znc/exec"; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô GAS URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì

    try {
      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          userId,
          tables: bookedTables,
          status: "Booked"
        })
      });

      if (!res.ok) throw new Error("‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");

      const data = await res.json();
      console.log("‚úÖ ‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheet ‡πÅ‡∏•‡πâ‡∏ß:", data);

      if (liff.isInClient()) {
        await liff.sendMessages([
          {
            type: "flex",
            altText: `‡∏à‡∏≠‡∏á‡πÇ‡∏ï‡πä‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${bookedTables.join(", ")}`,
            contents: {
              type: "bubble",
              body: {
                type: "box",
                layout: "vertical",
                contents: [
                  {
                    type: "text",
                    text: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á",
                    weight: "bold",
                    size: "lg",
                    margin: "none"
                  },
                  {
                    type: "text",
                    text: `‡πÇ‡∏ï‡πä‡∏∞: ${bookedTables.join(", ")}`,
                    wrap: true
                  },
                  {
                    type: "text",
                    text: `‡∏£‡∏ß‡∏° ${bookedTables.length * pricePerSeat} ‡∏ö‡∏≤‡∏ó`,
                    wrap: true
                  }
                ]
              }
            }
          }
        ]);
        liff.closeWindow();
      } else {
        alert(`‚úÖ ‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏ï‡πä‡∏∞: ${bookedTables.join(", ")}`);
      }
    } catch (err) {
      console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
      alert("‚ùå ‡∏à‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà");
    }
  }

  // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô LIFF
  liff.init({ liffId: "2007619597-pL1yYoj3" }) // ‡πÅ‡∏Å‡πâ‡πÄ‡∏õ‡πá‡∏ô LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    .then(() => {
      if (!liff.isLoggedIn()) {
        liff.login();
      } else {
        liff.getProfile().then(profile => {
          userId = profile.userId;
          console.log("üîê userId:", userId);
        });
      }
    })
    .catch(err => {
      console.error("‚ùå LIFF Init Error:", err);
      alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î LIFF ‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä");
    });
</script>


</body>
</html>
